/* PICMAN - The GNU Image Manipulation Program
 * Copyright (C) 1995-2003 Spencer Kimball and Peter Mattis
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation; either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */

/* NOTE: This file is auto-generated by pdbgen.pl. */

#include "config.h"

#include <cairo.h>

#include <gegl.h>

#include <gdk-pixbuf/gdk-pixbuf.h>

#include "libpicmanbase/picmanbase.h"
#include "libpicmancolor/picmancolor.h"

#include "libpicmanbase/picmanbase.h"

#include "pdb-types.h"

#include "core/picmanchannel-combine.h"
#include "core/picmanchannel.h"
#include "core/picmanimage.h"
#include "core/picmanparamspecs.h"

#include "picmanpdb.h"
#include "picmanprocedure.h"
#include "internal-procs.h"

#include "picman-intl.h"


static PicmanValueArray *
channel_new_invoker (PicmanProcedure         *procedure,
                     Picman                  *picman,
                     PicmanContext           *context,
                     PicmanProgress          *progress,
                     const PicmanValueArray  *args,
                     GError               **error)
{
  gboolean success = TRUE;
  PicmanValueArray *return_vals;
  PicmanImage *image;
  gint32 width;
  gint32 height;
  const gchar *name;
  gdouble opacity;
  PicmanRGB color;
  PicmanChannel *channel = NULL;

  image = picman_value_get_image (picman_value_array_index (args, 0), picman);
  width = g_value_get_int (picman_value_array_index (args, 1));
  height = g_value_get_int (picman_value_array_index (args, 2));
  name = g_value_get_string (picman_value_array_index (args, 3));
  opacity = g_value_get_double (picman_value_array_index (args, 4));
  picman_value_get_rgb (picman_value_array_index (args, 5), &color);

  if (success)
    {
      PicmanRGB rgb_color = color;

      rgb_color.a = opacity / 100.0;
      channel = picman_channel_new (image, width, height, name, &rgb_color);

      if (! channel)
        success = FALSE;
    }

  return_vals = picman_procedure_get_return_values (procedure, success,
                                                  error ? *error : NULL);

  if (success)
    picman_value_set_channel (picman_value_array_index (return_vals, 1), channel);

  return return_vals;
}

static PicmanValueArray *
channel_new_from_component_invoker (PicmanProcedure         *procedure,
                                    Picman                  *picman,
                                    PicmanContext           *context,
                                    PicmanProgress          *progress,
                                    const PicmanValueArray  *args,
                                    GError               **error)
{
  gboolean success = TRUE;
  PicmanValueArray *return_vals;
  PicmanImage *image;
  gint32 component;
  const gchar *name;
  PicmanChannel *channel = NULL;

  image = picman_value_get_image (picman_value_array_index (args, 0), picman);
  component = g_value_get_enum (picman_value_array_index (args, 1));
  name = g_value_get_string (picman_value_array_index (args, 2));

  if (success)
    {
      if (picman_image_get_component_format (image, component) != NULL)
        channel = picman_channel_new_from_component (image,
                                                   component, name, NULL);

      if (channel)
        picman_item_set_visible (PICMAN_ITEM (channel), FALSE, FALSE);
      else
        success = FALSE;
    }

  return_vals = picman_procedure_get_return_values (procedure, success,
                                                  error ? *error : NULL);

  if (success)
    picman_value_set_channel (picman_value_array_index (return_vals, 1), channel);

  return return_vals;
}

static PicmanValueArray *
channel_copy_invoker (PicmanProcedure         *procedure,
                      Picman                  *picman,
                      PicmanContext           *context,
                      PicmanProgress          *progress,
                      const PicmanValueArray  *args,
                      GError               **error)
{
  gboolean success = TRUE;
  PicmanValueArray *return_vals;
  PicmanChannel *channel;
  PicmanChannel *channel_copy = NULL;

  channel = picman_value_get_channel (picman_value_array_index (args, 0), picman);

  if (success)
    {
      channel_copy = PICMAN_CHANNEL (picman_item_duplicate (PICMAN_ITEM (channel),
                                   G_TYPE_FROM_INSTANCE (channel)));

      if (! channel_copy)
        success = FALSE;
    }

  return_vals = picman_procedure_get_return_values (procedure, success,
                                                  error ? *error : NULL);

  if (success)
    picman_value_set_channel (picman_value_array_index (return_vals, 1), channel_copy);

  return return_vals;
}

static PicmanValueArray *
channel_combine_masks_invoker (PicmanProcedure         *procedure,
                               Picman                  *picman,
                               PicmanContext           *context,
                               PicmanProgress          *progress,
                               const PicmanValueArray  *args,
                               GError               **error)
{
  gboolean success = TRUE;
  PicmanChannel *channel1;
  PicmanChannel *channel2;
  gint32 operation;
  gint32 offx;
  gint32 offy;

  channel1 = picman_value_get_channel (picman_value_array_index (args, 0), picman);
  channel2 = picman_value_get_channel (picman_value_array_index (args, 1), picman);
  operation = g_value_get_enum (picman_value_array_index (args, 2));
  offx = g_value_get_int (picman_value_array_index (args, 3));
  offy = g_value_get_int (picman_value_array_index (args, 4));

  if (success)
    {
      picman_channel_push_undo (channel1, _("Combine Masks"));
      picman_channel_combine_mask (channel1, channel2, operation, offx, offy);
    }

  return picman_procedure_get_return_values (procedure, success,
                                           error ? *error : NULL);
}

static PicmanValueArray *
channel_get_show_masked_invoker (PicmanProcedure         *procedure,
                                 Picman                  *picman,
                                 PicmanContext           *context,
                                 PicmanProgress          *progress,
                                 const PicmanValueArray  *args,
                                 GError               **error)
{
  gboolean success = TRUE;
  PicmanValueArray *return_vals;
  PicmanChannel *channel;
  gboolean show_masked = FALSE;

  channel = picman_value_get_channel (picman_value_array_index (args, 0), picman);

  if (success)
    {
      show_masked = picman_channel_get_show_masked (channel);
    }

  return_vals = picman_procedure_get_return_values (procedure, success,
                                                  error ? *error : NULL);

  if (success)
    g_value_set_boolean (picman_value_array_index (return_vals, 1), show_masked);

  return return_vals;
}

static PicmanValueArray *
channel_set_show_masked_invoker (PicmanProcedure         *procedure,
                                 Picman                  *picman,
                                 PicmanContext           *context,
                                 PicmanProgress          *progress,
                                 const PicmanValueArray  *args,
                                 GError               **error)
{
  gboolean success = TRUE;
  PicmanChannel *channel;
  gboolean show_masked;

  channel = picman_value_get_channel (picman_value_array_index (args, 0), picman);
  show_masked = g_value_get_boolean (picman_value_array_index (args, 1));

  if (success)
    {
      picman_channel_set_show_masked (channel, show_masked);
    }

  return picman_procedure_get_return_values (procedure, success,
                                           error ? *error : NULL);
}

static PicmanValueArray *
channel_get_opacity_invoker (PicmanProcedure         *procedure,
                             Picman                  *picman,
                             PicmanContext           *context,
                             PicmanProgress          *progress,
                             const PicmanValueArray  *args,
                             GError               **error)
{
  gboolean success = TRUE;
  PicmanValueArray *return_vals;
  PicmanChannel *channel;
  gdouble opacity = 0.0;

  channel = picman_value_get_channel (picman_value_array_index (args, 0), picman);

  if (success)
    {
      opacity = picman_channel_get_opacity (channel) * 100;
    }

  return_vals = picman_procedure_get_return_values (procedure, success,
                                                  error ? *error : NULL);

  if (success)
    g_value_set_double (picman_value_array_index (return_vals, 1), opacity);

  return return_vals;
}

static PicmanValueArray *
channel_set_opacity_invoker (PicmanProcedure         *procedure,
                             Picman                  *picman,
                             PicmanContext           *context,
                             PicmanProgress          *progress,
                             const PicmanValueArray  *args,
                             GError               **error)
{
  gboolean success = TRUE;
  PicmanChannel *channel;
  gdouble opacity;

  channel = picman_value_get_channel (picman_value_array_index (args, 0), picman);
  opacity = g_value_get_double (picman_value_array_index (args, 1));

  if (success)
    {
      picman_channel_set_opacity (channel, opacity / 100.0, TRUE);
    }

  return picman_procedure_get_return_values (procedure, success,
                                           error ? *error : NULL);
}

static PicmanValueArray *
channel_get_color_invoker (PicmanProcedure         *procedure,
                           Picman                  *picman,
                           PicmanContext           *context,
                           PicmanProgress          *progress,
                           const PicmanValueArray  *args,
                           GError               **error)
{
  gboolean success = TRUE;
  PicmanValueArray *return_vals;
  PicmanChannel *channel;
  PicmanRGB color = { 0.0, 0.0, 0.0, 1.0 };

  channel = picman_value_get_channel (picman_value_array_index (args, 0), picman);

  if (success)
    {
      picman_channel_get_color (channel, &color);
      picman_rgb_set_alpha (&color, 1.0);
    }

  return_vals = picman_procedure_get_return_values (procedure, success,
                                                  error ? *error : NULL);

  if (success)
    picman_value_set_rgb (picman_value_array_index (return_vals, 1), &color);

  return return_vals;
}

static PicmanValueArray *
channel_set_color_invoker (PicmanProcedure         *procedure,
                           Picman                  *picman,
                           PicmanContext           *context,
                           PicmanProgress          *progress,
                           const PicmanValueArray  *args,
                           GError               **error)
{
  gboolean success = TRUE;
  PicmanChannel *channel;
  PicmanRGB color;

  channel = picman_value_get_channel (picman_value_array_index (args, 0), picman);
  picman_value_get_rgb (picman_value_array_index (args, 1), &color);

  if (success)
    {
      PicmanRGB rgb_color = color;

      rgb_color.a = channel->color.a;
      picman_channel_set_color (channel, &rgb_color, TRUE);
    }

  return picman_procedure_get_return_values (procedure, success,
                                           error ? *error : NULL);
}

void
register_channel_procs (PicmanPDB *pdb)
{
  PicmanProcedure *procedure;

  /*
   * picman-channel-new
   */
  procedure = picman_procedure_new (channel_new_invoker);
  picman_object_set_static_name (PICMAN_OBJECT (procedure),
                               "picman-channel-new");
  picman_procedure_set_static_strings (procedure,
                                     "picman-channel-new",
                                     "Create a new channel.",
                                     "This procedure creates a new channel with the specified width and height. Name, opacity, and color are also supplied parameters. The new channel still needs to be added to the image, as this is not automatic. Add the new channel with the 'picman-image-insert-channel' command. Other attributes such as channel show masked, should be set with explicit procedure calls. The channel's contents are undefined initially.",
                                     "Spencer Kimball & Peter Mattis",
                                     "Spencer Kimball & Peter Mattis",
                                     "1995-1996",
                                     NULL);
  picman_procedure_add_argument (procedure,
                               picman_param_spec_image_id ("image",
                                                         "image",
                                                         "The image to which to add the channel",
                                                         pdb->picman, FALSE,
                                                         PICMAN_PARAM_READWRITE));
  picman_procedure_add_argument (procedure,
                               picman_param_spec_int32 ("width",
                                                      "width",
                                                      "The channel width",
                                                      1, PICMAN_MAX_IMAGE_SIZE, 1,
                                                      PICMAN_PARAM_READWRITE));
  picman_procedure_add_argument (procedure,
                               picman_param_spec_int32 ("height",
                                                      "height",
                                                      "The channel height",
                                                      1, PICMAN_MAX_IMAGE_SIZE, 1,
                                                      PICMAN_PARAM_READWRITE));
  picman_procedure_add_argument (procedure,
                               picman_param_spec_string ("name",
                                                       "name",
                                                       "The channel name",
                                                       FALSE, FALSE, FALSE,
                                                       NULL,
                                                       PICMAN_PARAM_READWRITE));
  picman_procedure_add_argument (procedure,
                               g_param_spec_double ("opacity",
                                                    "opacity",
                                                    "The channel opacity",
                                                    0, 100, 0,
                                                    PICMAN_PARAM_READWRITE));
  picman_procedure_add_argument (procedure,
                               picman_param_spec_rgb ("color",
                                                    "color",
                                                    "The channel compositing color",
                                                    FALSE,
                                                    NULL,
                                                    PICMAN_PARAM_READWRITE));
  picman_procedure_add_return_value (procedure,
                                   picman_param_spec_channel_id ("channel",
                                                               "channel",
                                                               "The newly created channel",
                                                               pdb->picman, FALSE,
                                                               PICMAN_PARAM_READWRITE));
  picman_pdb_register_procedure (pdb, procedure);
  g_object_unref (procedure);

  /*
   * picman-channel-new-from-component
   */
  procedure = picman_procedure_new (channel_new_from_component_invoker);
  picman_object_set_static_name (PICMAN_OBJECT (procedure),
                               "picman-channel-new-from-component");
  picman_procedure_set_static_strings (procedure,
                                     "picman-channel-new-from-component",
                                     "Create a new channel from a color component",
                                     "This procedure creates a new channel from a color component.",
                                     "Shlomi Fish <shlomif@iglu.org.il>",
                                     "Shlomi Fish",
                                     "2005",
                                     NULL);
  picman_procedure_add_argument (procedure,
                               picman_param_spec_image_id ("image",
                                                         "image",
                                                         "The image to which to add the channel",
                                                         pdb->picman, FALSE,
                                                         PICMAN_PARAM_READWRITE));
  picman_procedure_add_argument (procedure,
                               g_param_spec_enum ("component",
                                                  "component",
                                                  "The image component",
                                                  PICMAN_TYPE_CHANNEL_TYPE,
                                                  PICMAN_RED_CHANNEL,
                                                  PICMAN_PARAM_READWRITE));
  picman_procedure_add_argument (procedure,
                               picman_param_spec_string ("name",
                                                       "name",
                                                       "The channel name",
                                                       FALSE, FALSE, FALSE,
                                                       NULL,
                                                       PICMAN_PARAM_READWRITE));
  picman_procedure_add_return_value (procedure,
                                   picman_param_spec_channel_id ("channel",
                                                               "channel",
                                                               "The newly created channel",
                                                               pdb->picman, FALSE,
                                                               PICMAN_PARAM_READWRITE));
  picman_pdb_register_procedure (pdb, procedure);
  g_object_unref (procedure);

  /*
   * picman-channel-copy
   */
  procedure = picman_procedure_new (channel_copy_invoker);
  picman_object_set_static_name (PICMAN_OBJECT (procedure),
                               "picman-channel-copy");
  picman_procedure_set_static_strings (procedure,
                                     "picman-channel-copy",
                                     "Copy a channel.",
                                     "This procedure copies the specified channel and returns the copy.",
                                     "Spencer Kimball & Peter Mattis",
                                     "Spencer Kimball & Peter Mattis",
                                     "1995-1996",
                                     NULL);
  picman_procedure_add_argument (procedure,
                               picman_param_spec_channel_id ("channel",
                                                           "channel",
                                                           "The channel to copy",
                                                           pdb->picman, FALSE,
                                                           PICMAN_PARAM_READWRITE));
  picman_procedure_add_return_value (procedure,
                                   picman_param_spec_channel_id ("channel-copy",
                                                               "channel copy",
                                                               "The newly copied channel",
                                                               pdb->picman, FALSE,
                                                               PICMAN_PARAM_READWRITE));
  picman_pdb_register_procedure (pdb, procedure);
  g_object_unref (procedure);

  /*
   * picman-channel-combine-masks
   */
  procedure = picman_procedure_new (channel_combine_masks_invoker);
  picman_object_set_static_name (PICMAN_OBJECT (procedure),
                               "picman-channel-combine-masks");
  picman_procedure_set_static_strings (procedure,
                                     "picman-channel-combine-masks",
                                     "Combine two channel masks.",
                                     "This procedure combines two channel masks. The result is stored in the first channel.",
                                     "Spencer Kimball & Peter Mattis",
                                     "Spencer Kimball & Peter Mattis",
                                     "1995-1996",
                                     NULL);
  picman_procedure_add_argument (procedure,
                               picman_param_spec_channel_id ("channel1",
                                                           "channel1",
                                                           "The channel1",
                                                           pdb->picman, FALSE,
                                                           PICMAN_PARAM_READWRITE));
  picman_procedure_add_argument (procedure,
                               picman_param_spec_channel_id ("channel2",
                                                           "channel2",
                                                           "The channel2",
                                                           pdb->picman, FALSE,
                                                           PICMAN_PARAM_READWRITE));
  picman_procedure_add_argument (procedure,
                               g_param_spec_enum ("operation",
                                                  "operation",
                                                  "The selection operation",
                                                  PICMAN_TYPE_CHANNEL_OPS,
                                                  PICMAN_CHANNEL_OP_ADD,
                                                  PICMAN_PARAM_READWRITE));
  picman_procedure_add_argument (procedure,
                               picman_param_spec_int32 ("offx",
                                                      "offx",
                                                      "x offset between upper left corner of channels: (second - first)",
                                                      G_MININT32, G_MAXINT32, 0,
                                                      PICMAN_PARAM_READWRITE));
  picman_procedure_add_argument (procedure,
                               picman_param_spec_int32 ("offy",
                                                      "offy",
                                                      "y offset between upper left corner of channels: (second - first)",
                                                      G_MININT32, G_MAXINT32, 0,
                                                      PICMAN_PARAM_READWRITE));
  picman_pdb_register_procedure (pdb, procedure);
  g_object_unref (procedure);

  /*
   * picman-channel-get-show-masked
   */
  procedure = picman_procedure_new (channel_get_show_masked_invoker);
  picman_object_set_static_name (PICMAN_OBJECT (procedure),
                               "picman-channel-get-show-masked");
  picman_procedure_set_static_strings (procedure,
                                     "picman-channel-get-show-masked",
                                     "Get the composite method of the specified channel.",
                                     "This procedure returns the specified channel's composite method. If it is TRUE, then the channel is composited with the image so that masked regions are shown. Otherwise, selected regions are shown.",
                                     "Spencer Kimball & Peter Mattis",
                                     "Spencer Kimball & Peter Mattis",
                                     "1995-1996",
                                     NULL);
  picman_procedure_add_argument (procedure,
                               picman_param_spec_channel_id ("channel",
                                                           "channel",
                                                           "The channel",
                                                           pdb->picman, FALSE,
                                                           PICMAN_PARAM_READWRITE));
  picman_procedure_add_return_value (procedure,
                                   g_param_spec_boolean ("show-masked",
                                                         "show masked",
                                                         "The channel composite method",
                                                         FALSE,
                                                         PICMAN_PARAM_READWRITE));
  picman_pdb_register_procedure (pdb, procedure);
  g_object_unref (procedure);

  /*
   * picman-channel-set-show-masked
   */
  procedure = picman_procedure_new (channel_set_show_masked_invoker);
  picman_object_set_static_name (PICMAN_OBJECT (procedure),
                               "picman-channel-set-show-masked");
  picman_procedure_set_static_strings (procedure,
                                     "picman-channel-set-show-masked",
                                     "Set the composite method of the specified channel.",
                                     "This procedure sets the specified channel's composite method. If it is TRUE, then the channel is composited with the image so that masked regions are shown. Otherwise, selected regions are shown.",
                                     "Spencer Kimball & Peter Mattis",
                                     "Spencer Kimball & Peter Mattis",
                                     "1995-1996",
                                     NULL);
  picman_procedure_add_argument (procedure,
                               picman_param_spec_channel_id ("channel",
                                                           "channel",
                                                           "The channel",
                                                           pdb->picman, FALSE,
                                                           PICMAN_PARAM_READWRITE));
  picman_procedure_add_argument (procedure,
                               g_param_spec_boolean ("show-masked",
                                                     "show masked",
                                                     "The new channel composite method",
                                                     FALSE,
                                                     PICMAN_PARAM_READWRITE));
  picman_pdb_register_procedure (pdb, procedure);
  g_object_unref (procedure);

  /*
   * picman-channel-get-opacity
   */
  procedure = picman_procedure_new (channel_get_opacity_invoker);
  picman_object_set_static_name (PICMAN_OBJECT (procedure),
                               "picman-channel-get-opacity");
  picman_procedure_set_static_strings (procedure,
                                     "picman-channel-get-opacity",
                                     "Get the opacity of the specified channel.",
                                     "This procedure returns the specified channel's opacity.",
                                     "Spencer Kimball & Peter Mattis",
                                     "Spencer Kimball & Peter Mattis",
                                     "1995-1996",
                                     NULL);
  picman_procedure_add_argument (procedure,
                               picman_param_spec_channel_id ("channel",
                                                           "channel",
                                                           "The channel",
                                                           pdb->picman, FALSE,
                                                           PICMAN_PARAM_READWRITE));
  picman_procedure_add_return_value (procedure,
                                   g_param_spec_double ("opacity",
                                                        "opacity",
                                                        "The channel opacity",
                                                        0, 100, 0,
                                                        PICMAN_PARAM_READWRITE));
  picman_pdb_register_procedure (pdb, procedure);
  g_object_unref (procedure);

  /*
   * picman-channel-set-opacity
   */
  procedure = picman_procedure_new (channel_set_opacity_invoker);
  picman_object_set_static_name (PICMAN_OBJECT (procedure),
                               "picman-channel-set-opacity");
  picman_procedure_set_static_strings (procedure,
                                     "picman-channel-set-opacity",
                                     "Set the opacity of the specified channel.",
                                     "This procedure sets the specified channel's opacity.",
                                     "Spencer Kimball & Peter Mattis",
                                     "Spencer Kimball & Peter Mattis",
                                     "1995-1996",
                                     NULL);
  picman_procedure_add_argument (procedure,
                               picman_param_spec_channel_id ("channel",
                                                           "channel",
                                                           "The channel",
                                                           pdb->picman, FALSE,
                                                           PICMAN_PARAM_READWRITE));
  picman_procedure_add_argument (procedure,
                               g_param_spec_double ("opacity",
                                                    "opacity",
                                                    "The new channel opacity",
                                                    0, 100, 0,
                                                    PICMAN_PARAM_READWRITE));
  picman_pdb_register_procedure (pdb, procedure);
  g_object_unref (procedure);

  /*
   * picman-channel-get-color
   */
  procedure = picman_procedure_new (channel_get_color_invoker);
  picman_object_set_static_name (PICMAN_OBJECT (procedure),
                               "picman-channel-get-color");
  picman_procedure_set_static_strings (procedure,
                                     "picman-channel-get-color",
                                     "Get the compositing color of the specified channel.",
                                     "This procedure returns the specified channel's compositing color.",
                                     "Spencer Kimball & Peter Mattis",
                                     "Spencer Kimball & Peter Mattis",
                                     "1995-1996",
                                     NULL);
  picman_procedure_add_argument (procedure,
                               picman_param_spec_channel_id ("channel",
                                                           "channel",
                                                           "The channel",
                                                           pdb->picman, FALSE,
                                                           PICMAN_PARAM_READWRITE));
  picman_procedure_add_return_value (procedure,
                                   picman_param_spec_rgb ("color",
                                                        "color",
                                                        "The channel compositing color",
                                                        FALSE,
                                                        NULL,
                                                        PICMAN_PARAM_READWRITE));
  picman_pdb_register_procedure (pdb, procedure);
  g_object_unref (procedure);

  /*
   * picman-channel-set-color
   */
  procedure = picman_procedure_new (channel_set_color_invoker);
  picman_object_set_static_name (PICMAN_OBJECT (procedure),
                               "picman-channel-set-color");
  picman_procedure_set_static_strings (procedure,
                                     "picman-channel-set-color",
                                     "Set the compositing color of the specified channel.",
                                     "This procedure sets the specified channel's compositing color.",
                                     "Spencer Kimball & Peter Mattis",
                                     "Spencer Kimball & Peter Mattis",
                                     "1995-1996",
                                     NULL);
  picman_procedure_add_argument (procedure,
                               picman_param_spec_channel_id ("channel",
                                                           "channel",
                                                           "The channel",
                                                           pdb->picman, FALSE,
                                                           PICMAN_PARAM_READWRITE));
  picman_procedure_add_argument (procedure,
                               picman_param_spec_rgb ("color",
                                                    "color",
                                                    "The new channel compositing color",
                                                    FALSE,
                                                    NULL,
                                                    PICMAN_PARAM_READWRITE));
  picman_pdb_register_procedure (pdb, procedure);
  g_object_unref (procedure);
}
